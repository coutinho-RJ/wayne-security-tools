{% extends "base.html" %}
{% block title %}Usu√°rios do Sistema{% endblock %}

{% block content %}

<h1 class="page-title">Usu√°rios do Sistema</h1>
<p class="section-subtitle">
    Gerenciamento de contas, permiss√µes e n√≠veis de acesso das Ind√∫strias Wayne.
</p>

<div class="toolbar-card">
    {% if session.get('user_role') in ['admin', 'gerente'] %}
        <a href="{{ url_for('usuario_novo') }}" class="btn btn-primary">
            + Novo Usu√°rio
        </a>
    {% endif %}
</div>

<table class="table">
    <thead>
        <tr>
            <th>Nome</th>
            <th>Usu√°rio</th>
            <th>Papel</th>
            <th>Status</th>
            <th>Criado em</th>
            <th>A√ß√µes</th>
        </tr>
    </thead>

    <tbody>
        {% for u in usuarios %}
        <tr>
            <td>{{ u.name }}</td>
            <td>{{ u.username }}</td>
            <td>{{ u.role_name }}</td>

            <!-- STATUS -->
            <td>
                {% if u.approved == 1 %}
                    <span class="status-chip status-ok">Aprovado</span>
                {% else %}
                    <span class="status-chip status-pending">Pendente</span>
                {% endif %}
            </td>

            <td>{{ u.created_at }}</td>

            <td class="table-actions">

                {# üîí Se o usu√°rio logado N√ÉO for admin ou gerente ‚Üí mostrar apenas um tra√ßo #}
                {% if session.get('user_role') not in ['admin', 'gerente'] %}
                    ‚Äî
                {% else %}

                    {# Editar #}
                    <a href="{{ url_for('usuario_editar', usuario_id=u.id) }}"
                       class="btn btn-secondary btn-xs">
                        Editar
                    </a>

                    {# Remover ‚Äì somente admin #}
                    {% if session.get('user_role') == 'admin' %}
                        <form action="{{ url_for('usuario_remover', usuario_id=u.id) }}"
                              method="POST"
                              style="display:inline;">
                            <button type="submit"
                                    class="btn btn-danger btn-xs"
                                    onclick="return confirm('Deseja remover este usu√°rio?')">
                                Remover
                            </button>
                        </form>
                    {% endif %}

                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
